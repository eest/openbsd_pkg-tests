---
  # This playbook runs some tests on the openbsd_pkg module.
  # There are some shortcomings (that I handle manually):
  # * It does not verify the results of "--check" mode.
  # * It does not actually verify the presence of packages on the managed host.
  # * The specific version of a package ties those tests to a specific version
  #   of OpenBSD (in this case 6.0).
  # * Proper testing of "state=latest" is done by installing one version of
  #   OpenBSD with some packages, performing an upgrade via bsd.rd to the next
  #   version, and then upgrading packages from there (a virtual machine with
  #   snapshots helps a lot).
  #
  # See the file "hosts" in this repo for the basic hosts-file needed.
  #
  # Commandline:
  # ansible-playbook -i hosts -v -u root -c ssh openbsd_pkg-tests
  #
  # It is required to manually install python prior to testing this (and
  # creating the necessary symlinks).
  #
  # One way to check the result of the module is the following grep:
  # # grep pkg /var/log/messages

  - hosts: openbsd_pkg-tests
    tasks:
    - name: Reset status of bare stem package - may be changed
      action: openbsd_pkg name=nmap state=absent

    - name: Make sure bare stem package is present - should be changed
      action: openbsd_pkg name=nmap state=present
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is present again - should not be changed
      action: openbsd_pkg name=nmap state=present
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is absent - should be changed
      action: openbsd_pkg name=nmap state=absent
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is absent again - should not be changed
      action: openbsd_pkg name=nmap state=absent
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is latest - should be changed
      action: openbsd_pkg name=nmap state=latest
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is latest again - should not be changed
      action: openbsd_pkg name=nmap state=latest
      register: result
      failed_when: result.changed == True

    - name: Reset status of bare stem package again - should be changed
      action: openbsd_pkg name=nmap state=absent
      register: result
      failed_when: result.changed == False



    - name: Make sure bare stem package is present (clean) - should be changed
      action: openbsd_pkg name=nmap state=present clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is present again (clean) - should not be changed
      action: openbsd_pkg name=nmap state=present clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is absent (clean) - should be changed
      action: openbsd_pkg name=nmap state=absent clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is absent again (clean) - should not be changed
      action: openbsd_pkg name=nmap state=absent clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is latest (clean) - should be changed
      action: openbsd_pkg name=nmap state=latest clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is latest again (clean) - should not be changed
      action: openbsd_pkg name=nmap state=latest clean=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of bare stem package again (clean) - should be changed
      action: openbsd_pkg name=nmap state=absent clean=yes
      register: result
      failed_when: result.changed == False




    - name: Make sure bare stem package is present (quick) - should be changed
      action: openbsd_pkg name=nmap state=present quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is present again (quick) - should not be changed
      action: openbsd_pkg name=nmap state=present quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is absent (quick) - should be changed
      action: openbsd_pkg name=nmap state=absent quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is absent again (quick) - should not be changed
      action: openbsd_pkg name=nmap state=absent quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is latest (quick) - should be changed
      action: openbsd_pkg name=nmap state=latest quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is latest again (quick) - should not be changed
      action: openbsd_pkg name=nmap state=latest quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of bare stem package again (quick) - should be changed
      action: openbsd_pkg name=nmap state=absent quick=yes
      register: result
      failed_when: result.changed == False




    - name: Make sure bare stem package is present (clean+quick) - should be changed
      action: openbsd_pkg name=nmap state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is present again (clean+quick) - should not be changed
      action: openbsd_pkg name=nmap state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is absent (clean+quick) - should be changed
      action: openbsd_pkg name=nmap state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is absent again (clean+quick) - should not be changed
      action: openbsd_pkg name=nmap state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is latest (clean+quick) - should be changed
      action: openbsd_pkg name=nmap state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is latest again (clean+quick) - should not be changed
      action: openbsd_pkg name=nmap state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of bare stem package again (clean+quick) - should be changed
      action: openbsd_pkg name=nmap state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False




    - name: Reset status of version- and flavor-less package - may be changed
      action: openbsd_pkg name=nmap-- state=absent

    - name: Make sure version- and flavor-less package is present - should be changed
      action: openbsd_pkg name=nmap-- state=present
      register: result
      failed_when: result.changed == False

    - name: Make sure verison- and flavor-less package is present again - should not be changed
      action: openbsd_pkg name=nmap-- state=present
      register: result
      failed_when: result.changed == True

    - name: Make sure version- and flavor-less package is absent - should be changed
      action: openbsd_pkg name=nmap-- state=absent
      register: result
      failed_when: result.changed == False

    - name: Make sure version- and flavor-less package is absent again - should not be changed
      action: openbsd_pkg name=nmap-- state=absent
      register: result
      failed_when: result.changed == True

    - name: Make sure version- and flavor-less package is latest - should be changed
      action: openbsd_pkg name=nmap-- state=latest
      register: result
      failed_when: result.changed == False

    - name: Make sure version- and flavor-less package is latest again - should not be changed
      action: openbsd_pkg name=nmap-- state=latest
      register: result
      failed_when: result.changed == True

    - name: Reset status of version- and flavor-less package again - should be changed
      action: openbsd_pkg name=nmap-- state=absent
      register: result
      failed_when: result.changed == False



    - name: Reset status of version- and flavor-less package (clean) - may be changed
      action: openbsd_pkg name=nmap-- state=absent clean=yes

    - name: Make sure version- and flavor-less package is present (clean) - should be changed
      action: openbsd_pkg name=nmap-- state=present clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure verison- and flavor-less package is present again (clean) - should not be changed
      action: openbsd_pkg name=nmap-- state=present clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version- and flavor-less package is absent (clean) - should be changed
      action: openbsd_pkg name=nmap-- state=absent clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version- and flavor-less package is absent again (clean) - should not be changed
      action: openbsd_pkg name=nmap-- state=absent clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version- and flavor-less package is latest (clean) - should be changed
      action: openbsd_pkg name=nmap-- state=latest clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version- and flavor-less package is latest again (clean) - should not be changed
      action: openbsd_pkg name=nmap-- state=latest clean=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of version- and flavor-less package again (clean) - should be changed
      action: openbsd_pkg name=nmap-- state=absent clean=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of version- and flavor-less package (quick) - may be changed
      action: openbsd_pkg name=nmap-- state=absent quick=yes

    - name: Make sure version- and flavor-less package is present (quick) - should be changed
      action: openbsd_pkg name=nmap-- state=present quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure verison- and flavor-less package is present again (quick) - should not be changed
      action: openbsd_pkg name=nmap-- state=present quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version- and flavor-less package is absent (quick) - should be changed
      action: openbsd_pkg name=nmap-- state=absent quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version- and flavor-less package is absent again (quick) - should not be changed
      action: openbsd_pkg name=nmap-- state=absent quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version- and flavor-less package is latest (quick) - should be changed
      action: openbsd_pkg name=nmap-- state=latest quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version- and flavor-less package is latest again (quick) - should not be changed
      action: openbsd_pkg name=nmap-- state=latest quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of version- and flavor-less package again (quick) - should be changed
      action: openbsd_pkg name=nmap-- state=absent quick=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of version- and flavor-less package (clean+quick) - may be changed
      action: openbsd_pkg name=nmap-- state=absent clean=yes quick=yes

    - name: Make sure version- and flavor-less package is present (clean+quick) - should be changed
      action: openbsd_pkg name=nmap-- state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure verison- and flavor-less package is present again (clean+quick) - should not be changed
      action: openbsd_pkg name=nmap-- state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version- and flavor-less package is absent (clean+quick) - should be changed
      action: openbsd_pkg name=nmap-- state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version- and flavor-less package is absent again (clean+quick) - should not be changed
      action: openbsd_pkg name=nmap-- state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version- and flavor-less package is latest (clean+quick) - should be changed
      action: openbsd_pkg name=nmap-- state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version- and flavor-less package is latest again (clean+quick) - should not be changed
      action: openbsd_pkg name=nmap-- state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of version- and flavor-less package again (clean+quick) - should be changed
      action: openbsd_pkg name=nmap-- state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of package with specific version - may be changed
      action: openbsd_pkg name=nmap-7.40 state=absent

    - name: Make sure package with specific verison is present - should be changed
      action: openbsd_pkg name=nmap-7.40 state=present
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is present again - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=present
      register: result
      failed_when: result.changed == True

    - name: Make sure package with specific verison is absent - should be changed
      action: openbsd_pkg name=nmap-7.40 state=absent
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is absent again - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=absent
      register: result
      failed_when: result.changed == True

    - name: Make sure package with specific version is latest - should be changed
      action: openbsd_pkg name=nmap-7.40 state=latest
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is latest again - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=latest
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with specific version again - should be changed
      action: openbsd_pkg name=nmap-7.40 state=absent
      register: result
      failed_when: result.changed == False



    - name: Reset status of package with specific version (clean) - may be changed
      action: openbsd_pkg name=nmap-7.40 state=absent clean=yes

    - name: Make sure package with specific verison is present (clean) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=present clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is present again (clean) - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=present clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with specific verison is absent (clean) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=absent clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is absent again (clean) - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=absent clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with specific version is latest (clean) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=latest clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is latest again (clean) - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=latest clean=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with specific version again (clean) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=absent clean=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of package with specific version (quick) - may be changed
      action: openbsd_pkg name=nmap-7.40 state=absent quick=yes

    - name: Make sure package with specific verison is present (quick) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=present quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is present again (quick) - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=present quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with specific verison is absent (quick) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=absent quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is absent again (quick) - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=absent quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with specific version is latest (quick) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=latest quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is latest again (quick) - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=latest quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with specific version again (quick) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=absent quick=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of package with specific version (clean+quick) - may be changed
      action: openbsd_pkg name=nmap-7.40 state=absent clean=yes quick=yes

    - name: Make sure package with specific verison is present (clean+quick) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is present again (clean+quick) - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with specific verison is absent (clean+quick) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is absent again (clean+quick) - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with specific version is latest (clean+quick) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with specific version is latest again (clean+quick) - should not be changed
      action: openbsd_pkg name=nmap-7.40 state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with specific version again (clean+quick) - should be changed
      action: openbsd_pkg name=nmap-7.40 state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of version-less package - may be changed
      action: openbsd_pkg name=vim--no_x11 state=absent

    - name: Make sure version-less package is present - should be changed
      action: openbsd_pkg name=vim--no_x11 state=present
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is present again - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=present
      register: result
      failed_when: result.changed == True

    - name: Make sure version-less package is absent - should be changed
      action: openbsd_pkg name=vim--no_x11 state=absent
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is absent again - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=absent
      register: result
      failed_when: result.changed == True

    - name: Make sure version-less package is latest - should be changed
      action: openbsd_pkg name=vim--no_x11 state=latest
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is latest again - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=latest
      register: result
      failed_when: result.changed == True

    - name: Reset status of version-less package again - should be changed
      action: openbsd_pkg name=vim--no_x11 state=absent
      register: result
      failed_when: result.changed == False



    - name: Reset status of version-less package (clean) - may be changed
      action: openbsd_pkg name=vim--no_x11 state=absent clean=yes

    - name: Make sure version-less package is present (clean) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=present clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is present again (clean) - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=present clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version-less package is absent (clean) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=absent clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is absent again (clean) - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=absent clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version-less package is latest (clean) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=latest clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is latest again (clean) - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=latest clean=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of version-less package again (clean) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=absent clean=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of version-less package (quick) - may be changed
      action: openbsd_pkg name=vim--no_x11 state=absent quick=yes

    - name: Make sure version-less package is present - should be changed
      action: openbsd_pkg name=vim--no_x11 state=present quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is present again (quick) - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=present quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version-less package is absent (quick) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=absent quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is absent again (quick) - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=absent quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version-less package is latest (quick) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=latest quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is latest again (quick) - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=latest quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of version-less package again (quick) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=absent quick=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of version-less package (clean+quick) - may be changed
      action: openbsd_pkg name=vim--no_x11 state=absent clean=yes quick=yes

    - name: Make sure version-less package is present - should be changed
      action: openbsd_pkg name=vim--no_x11 state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is present again (clean+quick) - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version-less package is absent (clean+quick) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is absent again (clean+quick) - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure version-less package is latest (clean+quick) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure version-less package is latest again (clean+quick) - should not be changed
      action: openbsd_pkg name=vim--no_x11 state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of version-less package again (clean+quick) - should be changed
      action: openbsd_pkg name=vim--no_x11 state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of package with version and (multiple) flavors - may be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent

    - name: Make sure package with version and (multiple) flavors is present - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=present
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is present again - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=present
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is absent - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is absent again - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is latest - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=latest
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is latest again - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=latest
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with version and (multiple) flavors again - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent
      register: result
      failed_when: result.changed == False



    - name: Reset status of package with version and (multiple) flavors (clean) - may be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent clean=yes

    - name: Make sure package with version and (multiple) flavors is present (clean) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=present clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is present again (clean) - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=present clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is absent (clean) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is absent again (clean) - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is latest (clean) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=latest clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is latest again (clean) - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=latest clean=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with version and (multiple) flavors again (clean) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent clean=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of package with version and (multiple) flavors (quick) - may be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent quick=yes

    - name: Make sure package with version and (multiple) flavors is present (quick) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=present quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is present again (quick) - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=present quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is absent (quick) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is absent again (quick) - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is latest (quick) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=latest quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is latest again (quick) - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=latest quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with version and (multiple) flavors again (quick) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent quick=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of package with version and (multiple) flavors (clean+quick) - may be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent clean=yes quick=yes

    - name: Make sure package with version and (multiple) flavors is present (clean+quick) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is present again (clean+quick) - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is absent (clean+quick) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is absent again (clean+quick) - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is latest (clean+quick) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is latest again (clean+quick) - should not be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with version and (multiple) flavors again (clean+quick) - should be changed
      action: openbsd_pkg name=mutt-1.7.2v3-sasl-slang state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False



    - name: Reset status of package with branch - may be changed
      action: openbsd_pkg name=python%3.5 state=absent

    - name: Make sure package with version and (multiple) flavors is present - should be changed
      action: openbsd_pkg name=python%3.5 state=present
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is present again - should not be changed
      action: openbsd_pkg name=python%3.5 state=present
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is absent - should be changed
      action: openbsd_pkg name=python%3.5 state=absent
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is absent again - should not be changed
      action: openbsd_pkg name=python%3.5 state=absent
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is latest - should be changed
      action: openbsd_pkg name=python%3.5 state=latest
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is latest again - should not be changed
      action: openbsd_pkg name=python%3.5 state=latest
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with version and (multiple) flavors again - should be changed
      action: openbsd_pkg name=python%3.5 state=absent
      register: result
      failed_when: result.changed == False

    - name: Attempt to upgrade all packages - may be changed
      action: openbsd_pkg name=* state=latest



    - name: Reset status of package with branch (clean) - may be changed
      action: openbsd_pkg name=python%3.5 state=absent clean=yes

    - name: Make sure package with version and (multiple) flavors is present (clean) - should be changed
      action: openbsd_pkg name=python%3.5 state=present clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is present again (clean) - should not be changed
      action: openbsd_pkg name=python%3.5 state=present clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is absent (clean) - should be changed
      action: openbsd_pkg name=python%3.5 state=absent clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is absent again (clean) - should not be changed
      action: openbsd_pkg name=python%3.5 state=absent clean=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is latest (clean) - should be changed
      action: openbsd_pkg name=python%3.5 state=latest clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is latest again (clean) - should not be changed
      action: openbsd_pkg name=python%3.5 state=latest clean=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with version and (multiple) flavors again (clean) - should be changed
      action: openbsd_pkg name=python%3.5 state=absent clean=yes
      register: result
      failed_when: result.changed == False

    - name: Attempt to upgrade all packages (clean) - may be changed
      action: openbsd_pkg name=* state=latest clean=yes



    - name: Reset status of package with branch (quick) - may be changed
      action: openbsd_pkg name=python%3.5 state=absent quick=yes

    - name: Make sure package with version and (multiple) flavors is present (quick) - should be changed
      action: openbsd_pkg name=python%3.5 state=present quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is present again (quick) - should not be changed
      action: openbsd_pkg name=python%3.5 state=present quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is absent (quick) - should be changed
      action: openbsd_pkg name=python%3.5 state=absent clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is absent again (quick) - should not be changed
      action: openbsd_pkg name=python%3.5 state=absent quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is latest (quick) - should be changed
      action: openbsd_pkg name=python%3.5 state=latest quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is latest again (quick) - should not be changed
      action: openbsd_pkg name=python%3.5 state=latest quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with version and (multiple) flavors again (quick) - should be changed
      action: openbsd_pkg name=python%3.5 state=absent quick=yes
      register: result
      failed_when: result.changed == False

    - name: Attempt to upgrade all packages (quick) - may be changed
      action: openbsd_pkg name=* state=latest quick=yes



    - name: Reset status of package with branch (clean+quick) - may be changed
      action: openbsd_pkg name=python%3.5 state=absent clean=yes quick=yes

    - name: Make sure package with version and (multiple) flavors is present (clean+quick) - should be changed
      action: openbsd_pkg name=python%3.5 state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is present again (clean+quick) - should not be changed
      action: openbsd_pkg name=python%3.5 state=present clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is absent (clean+quick) - should be changed
      action: openbsd_pkg name=python%3.5 state=absent clean=yes clean=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is absent again (clean+quick) - should not be changed
      action: openbsd_pkg name=python%3.5 state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Make sure package with version and (multiple) flavors is latest (clean+quick) - should be changed
      action: openbsd_pkg name=python%3.5 state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Make sure package with version and (multiple) flavors is latest again (clean+quick) - should not be changed
      action: openbsd_pkg name=python%3.5 state=latest clean=yes quick=yes
      register: result
      failed_when: result.changed == True

    - name: Reset status of package with version and (multiple) flavors again (clean+quick) - should be changed
      action: openbsd_pkg name=python%3.5 state=absent clean=yes quick=yes
      register: result
      failed_when: result.changed == False

    - name: Attempt to upgrade all packages (clean+quick) - may be changed
      action: openbsd_pkg name=* state=latest clean=yes quick=yes



    - name: Reset status of package list - may be changed
      action: openbsd_pkg name={{ item }} state=absent
      with_items:
          - nmap-7.40
          - bwm-ng
          - mtr--
          - python%3.5

    - name: Make sure bare stem package is present - should be changed
      action: openbsd_pkg name={{ item }} state=present
      with_items:
          - nmap-7.40
          - bwm-ng
          - mtr--
          - python%3.5
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is present again - should not be changed
      action: openbsd_pkg name={{ item }} state=present
      with_items:
          - nmap-7.40
          - bwm-ng
          - mtr--
          - python%3.5
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is absent - should be changed
      action: openbsd_pkg name={{ item }} state=absent
      with_items:
          - nmap-7.40
          - bwm-ng
          - mtr--
          - python%3.5
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is absent again - should not be changed
      action: openbsd_pkg name={{ item }} state=absent
      with_items:
          - nmap-7.40
          - bwm-ng
          - mtr--
          - python%3.5
      register: result
      failed_when: result.changed == True

    - name: Make sure bare stem package is latest - should be changed
      action: openbsd_pkg name={{ item }} state=latest
      with_items:
          - nmap-7.40
          - bwm-ng
          - mtr--
          - python%3.5
      register: result
      failed_when: result.changed == False

    - name: Make sure bare stem package is latest again - should not be changed
      action: openbsd_pkg name={{ item }} state=latest
      with_items:
          - nmap-7.40
          - bwm-ng
          - mtr--
          - python%3.5
      register: result
      failed_when: result.changed == True

    - name: Reset status of bare stem package again - should be changed
      action: openbsd_pkg name={{ item }} state=absent
      with_items:
          - nmap-7.40
          - bwm-ng
          - mtr--
          - python%3.5
      register: result
      failed_when: result.changed == False
